#!/bin/bash

BASE="/usr/share/asistente-actualizacion/"
. $BASE"pasobash"

case "$PASO" in
  2)
	echo "****************22"
	mkdir -p $BASE

	###VERIFICAR SOURCES.LIST


	echo "****************instalando galeon" 
	# Obtenemos las ultimas versiones de los paquetes y actualizamos 2.1
	aptitude update && apt-get autoclean&&aptitude --assume-yes full-upgrade
	# Instalamos otro proveedor de gnome-www-browser
	DEBIAN_FRONTEND=noninteractive aptitude install --assume-yes galeon 



	rm /etc/default/grub
	echo "Limpiando sistema" | zenity --notification --listen &
	echo "Limpiando sistema quitando openoffice" 
	DEBIAN_FRONTEND=noninteractive apt-get purge --force-yes -y openoffice* 
	DEBIAN_FRONTEND=noninteractive apt-get purge --force-yes -y firefox*
	echo "****************desinstalando thunderbird" 
	DEBIAN_FRONTEND=noninteractive apt-get purge --force-yes -y thunderbird*
	echo "****************desinstalando splashy" 
	DEBIAN_FRONTEND=noninteractive apt-get purge --force-yes -y splashy*
	echo "Limpiando sistema autoremove" 
	DEBIAN_FRONTEND=noninteractive apt-get autoremove --force-yes -y 


	echo "Actualizando fuentes de software del sistema" | zenity --notification --listen &
	cp /etc/apt/sources.list $BASE"sources.list.original"
	echo "**************** copindo sources.list"
	cat /etc/apt/sources.list
	cp $BASE"sources.list" /etc/apt/sources.list
	cp /etc/apt/preferences $BASE"preferences.original"
	cp $BASE"preferences" /etc/apt/preferences

	export DEBIAN_FRONTEND="noninteractive"
	debconf-set-selections $BASE"selections.conf"

	aptitude update && apt-get autoclean




	echo "****************2"
	aptitude update && apt-get autoclean
	echo "**************** sources.list final"
	cat /etc/apt/sources.list
	echo "*************3"
	echo "Actualizando componentes basicos" | zenity --notification --listen &
	echo "actualizando componentes basicos aptitude apt dpkg debian-keyring locales linux-image-2.6.32-5-686"
	DEBIAN_FRONTEND=noninteractive apt-get install --force-yes -y aptitude apt dpkg debian-keyring locales && apt-get -f install
	DEBIAN_FRONTEND=noninteractive aptitude install --assume-yes linux-image-2.6.32-5-686
	echo "**********4"
	echo 'PASO=3' > $BASE"pasobash"
	echo "El sistema se reiniciará en 15 segundos para continuar con la actualización" | zenity --notification --listen &
	echo "********5"
#	reboot
        exit 1
  ;;
  3)
	echo "****************33"
	echo "Actualizando segundos componentes basicos" | zenity --notification --listen &
	debconf-set-selections $BASE"selections.conf"
	mkdir -p /etc/skel/.mozilla/firefox/canaima.default/
	touch /etc/skel/.mozilla/firefox/canaima.default/cert8.db
	DEBIAN_FRONTEND=noninteractive apt-get --force-yes -y -f install 
	DEBIAN_FRONTEND=noninteractive apt-get install --force-yes -y udev
	echo 'PASO=4' > $BASE"pasobash"
	echo "El sistema se reiniciará de nuevo en 15 segundos para continuar con la actualización" | zenity --notification --listen &
	sleep 15
#	reboot
        exit 1

  ;;
  4)
	echo "****************44"
	echo "Actualizando base del sistema." | zenity --notification --listen &
	cat /etc/apt/sources.list
	cat /etc/apt/preferences
	debconf-set-selections $BASE"selections.conf"
	aptitude install canaima-llaves
	DEBIAN_FRONTEND=noninteractive aptitude --assume-yes dist-upgrade
	DEBIAN_FRONTEND=noninteractive aptitude --assume-yes full-upgrade
    aptitude install gconf2=2.28.1-6 libgconf2-4=2.28.1-6 gconf2-common=2.28.1-6
	echo 'PASO=5' > $BASE"pasobash"
	echo "El sistema se reiniciará de nuevo en 15 segundos para continuar con la actualización" | zenity --notification --listen &
	sleep 15
#	reboot
        exit 1

	

  ;;
  5)
	echo "Actualizando resto del sistema." | zenity --notification --listen &
	rm /etc/skel/.purple/accels /etc/skel/.purple/accounts.xml /etc/skel/.purple/blist.xml /etc/skel/.purple/status.xml	
	cp $BASE"preferences.canaima" /etc/apt/preferences
	cp $BASE"sources.list.canaima" /etc/apt/sources.list
	aptitude update && apt-get autoclean
	DEBIAN_FRONTEND=noninteractive aptitude purge --assume-yes epiphany-browser epiphany-browser-data libgraphviz4 libslab0 gtkhtml3.14 busybox-syslogd dsyslog inetutils-syslogd rsyslog socklog-run sysklogd syslog-ng libfam0c102
	debconf-set-selections $BASE"selections.conf"
	DEBIAN_FRONTEND=noninteractive aptitude --assume-yes full-upgrade
	DEBIAN_FRONTEND=noninteractive aptitude purge --assume-yes galeon
	DEBIAN_FRONTEND=noninteractive aptitude --assume-yes canaima-escritorio-gnome 
	echo 'PASO=6' > $BASE"pasobash"
	echo "El sistema se reiniciará de nuevo en 15 segundos para continuar con la actualización" | zenity --notification --listen &
	sleep 15
#	reboot
        exit 1

  ;;
  6)
    dpkg-reconfigure canaima-estilo-visual
    ####borrar gconf de cada usuario
	echo "Actualizacion finalizada con EXITO." | zenity --notification --listen &
	echo "ya deberia tener hecho todo papito"
        exit 1
  ;;
  *)
	echo 'PASO=2' > $BASE"pasobash"
        echo "Ejecutese de nuevo"
        exit 1
  ;;
esac

